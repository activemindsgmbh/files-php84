<?php

$boundary = sha1 (uniqid(mt_rand(), true));
$name = mime_encode(($rechnung->vorname ? $rechnung->vorname . ' ' : '') . $rechnung->name);
$pdf = chunk_split (base64_encode(@file_get_contents("{$GLOBALS['conf_dir_rechnung_kunde']}/{$rechnung->id}.pdf")));

date_default_timezone_set('Etc/UTC');
$date = date('r');

$header_date = "Date: {$date}";
$message_id = sha1(uniqid(mt_rand(), true)) . '@activeminds.de';
$eml = <<<EOT
From: "active minds GmbH" <buchhaltung@activeminds.de>
To: "{$name}" <{$rechnung->rechnungsemail}>
Bcc: buchhaltung@activeminds.de
Subject: active minds GmbH Rechnung Nr.: {$rechnung->id}
{$header_date}
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="{$boundary}"
Disposition-Notification-To: <buchhaltung@activeminds.de> // DSN
Return-Receipt-To: <buchhaltung@activeminds.de> // MDN

This is a multi-part message in MIME format.
--{$boundary}
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit

Sehr geehrte Damen und Herren,

anbei übersenden wir Ihnen unsere aktuelle Rechnung als PDF-Datei und bitten um Zahlung auf unser Bankkonto.

Sofern Sie uns eine Einzugsermächtigung erteilt haben, werden wir den Rechnungsbetrag in den nächsten Tagen von Ihrem Konto abbuchen.

Bei Rückfragen stehen wir Ihnen gerne zur Verfügung.

Mit freundlichen Grüßen


EOT;

ob_start ();
include ('sig.txt');
$eml .= rtrim (ob_get_contents()) . "\n\n";
ob_end_clean ();

$eml .= <<<EOT
--{$boundary}
Content-Type: application/pdf; name="activeminds.pdf"
Content-Transfer-Encoding: base64
Content-Disposition: inline; filename="activeminds.pdf"

{$pdf}
--{$boundary}--
EOT;

sendmail ($eml, $GLOBALS['conf_email_return_path']);

?>
